# RISCV-OS-Experiments-Guide 操作系统原理教学框架

本项目为 2025年全国大学生计算机系统能力大赛-操作系统设计赛-西北区域赛 参赛项目仓库。我们选择的赛题为 proj0-面向操作系统课程的操作系统竞赛和实验中的题目二。

![image-20251230173443056](picture/image-20251230173443056.png)

## 一、目标描述

本项目构建了一套循序渐进的操作系统实验教学体系，旨在解决传统操作系统课程中理论与实践脱节的教学痛点。不同于侧重裸机开发的传统内核构建课程，本框架采用“系统编程为引，内核机制为本”的教学范式，引导学习者在 Linux 环境下通过 POSIX 标准接口深入剖析操作系统的核心子系统。项目严格对应操作系统的关键抽象层次，从基础环境构建开始，依次深入存储管理、文件系统、进程生命周期、多线程并发模型以及进程间通信机制。所有的实验代码均基于 C 语言编写，并严格遵循 Linux 系统调用规范，旨在通过具有实际工程意义的代码实现，将抽象的操作系统概念转化为可视化的运行逻辑。

## 二、比赛题目分析和相关资料调研

在对现有操作系统教学资源进行广泛调研后，我们发现目前的教学路径主要分为两类，一类是基于 xv6 或 Linux 内核源码的内核开发，另一类是纯概念性的理论讲授。经过分析，我们认为在“内核开发”与“理论讲授”之间存在一个“系统编程”的断层。设计赛道强调系统的完整性与工程性，因此我们选择以 POSIX 标准接口为切入点，通过在用户态复现内核机制（如使用 `clone` 模拟容器隔离，使用互斥锁解决原子性问题）的路径来进行系统设计。这种方案既能保证实验的工程深度，又能避免陷入硬件驱动适配的泥潭，从而集中精力解决核心的系统逻辑问题。

## 三、系统框架设计

本系统的整体架构设计遵循由静态资源到动态执行、由用户态模拟到内核态观察的逻辑演进路线。系统底层基于 Linux 内核提供的系统调用接口，向上构建了六个核心实验模块和一个综合实验模块。基础层包含了对 Linux 环境的认知与静态资源的抽象；进阶层通过进程控制与线程模型的实现，接管系统的计算资源；协同层通过管道与信号量机制，实现不同执行单元之间的数据交互。顶层的综合实验模块则集成了 NoAxiom-OS 内核。这种分层设计确保了知识体系的完整性与逻辑递进性。

## 四、开发计划

项目的开发工作严格按照预定路线推进。第一阶段集中于基础环境的搭建与静态资源管理工具的开发，重点实现了内存地址分析工具与文件元数据操作工具。第二阶段完成了进程生命周期管理工具的开发，并实现了基于 PID 命名空间的隔离环境。第三阶段专注于并发控制与通信机制，完成了多线程编程与管道通信系统的编码工作。第四阶段则是综合实验的适配工作，主要任务是配置 NoAxiom-OS 的编译环境并成功运行该内核，以验证其在模拟器中的表现。

## 五、比赛过程中的重要进展

在比赛过程中，团队取得了多个关键性的技术突破。在基础实验阶段，我们成功利用 Linux 系统调用复现了 Shell 的核心逻辑以及文件系统的递归复制功能，验证了“一切皆文件”的设计哲学。在并发编程模块，我们通过对比实验直观地展示了竞态条件的危害，并验证了互斥锁机制的有效性。最关键的进展在于综合实验阶段，团队克服了工具链版本的兼容性问题，成功编译并启动了 NoAxiom-OS 内核，并能够通过串口输出观察到内核启动阶段的内存初始化与进程调度过程，完成了从用户态编程到内核态观察的跨越。

## 六、系统测试情况

为了保证系统的有效性，我们建立了一套分层验证体系。针对前六个 Linux 基础实验，我们采用功能验证测试，例如使用 diff 指令比对目录克隆工具的输出一致性，编写脚本测试 Shell 的后台任务管理功能，以及通过高并发计数器验证多线程锁机制的稳定性。针对综合实验 NoAxiom-OS，我们的测试重点在于环境适配性与内核启动流程的完整性验证。测试结果显示，所有基础实验代码均能在标准 Linux 环境下正确运行，综合实验内核也能在 QEMU 模拟器中顺利启动并进入交互界面，达到了预期的教学演示效果。

## 七、遇到的主要问题和解决方法

在进程间通信实验中，曾遭遇管道缓冲区阻塞导致死锁的问题，我们通过查阅文档并调整读写缓冲区的逻辑顺序解决了该问题。在综合实验阶段，NoAxiom-OS 的构建过程依赖特定的 Rust 工具链版本，导致在本地环境中编译失败。团队通过分析其构建脚本，重新配置了 rustup 工具链并修正了部分依赖库的版本号，最终解决了编译错误。此外，为了让学生更好地理解用户态线程与内核态线程的区别，我们通过增加对比实验文档的方式，强化了理论层面的解释。

## 八、分工和协作

团队利用 Git 版本控制系统进行代码的合并与文档的同步，通过定期的线下会议交流实验心得，确保了各个实验模块在教学逻辑上的连贯性与一致性。

## 九、提交仓库目录和文件描述

位于根目录下的 `src` 文件夹作为公共代码库，存储了实验中题目涉及的所有代码。

### 实验一：初步了解 Linux

作为整个课程体系的基石，本模块致力于构建标准化的操作系统实验环境。学习者将在此阶段安装 Linux， 并熟悉 Linux 命令行界面的交互逻辑。

### 实验二：存储管理

本模块聚焦于操作系统中最核心的资源管理机制之一——内存管理。

本模块立足于操作系统存储管理的核心理论与实践应用，通过对虚拟内存映射、内存安全隔离、页面置换算法模拟以及内存映射优化等关键技术的深度拆解，系统地展示了操作系统如何高效利用并保护有限的物理内存资源。通过该模块的学习，学习者将深入理解虚拟存储技术在突破硬件瓶颈、解决地址冲突及强化系统安全方面的核心作用，熟练掌握动态内存管理与高效文件 I/O 的实现手段，并能够运用系统观测工具与置换算法模型，对复杂的内存运行状态进行精细化分析与性能优化，从而构建起从底层机制到高层应用的完整存储管理知识体系。

### 实验三：文件系统

本实验将系统探索操作系统持久化存储的核心机制，引导学习者从接口调用、结构解析到底层构建，全面理解Linux文件系统的工作原理。学习者首先通过编写目录复制工具my_cp，掌握底层I/O接口，理解文件描述符管理字节流与目录项组织的核心机制。接着，实验将剖析Inode与Dentry结构，揭示文件在二进制层面的组织逻辑，并观察SUID权限体系的安全控制原理。在此基础上，学习者将进入内核开发视角，在内存中构建4MB虚拟磁盘，实现简化Ext2文件系统。通过设计超级块、位图与Inode，手动管理数据块分配，并模拟核心文件操作，理解文件系统如何在存储介质中建立秩序与管理物理边界。

### 实验四：进程管理

进程是操作系统资源分配的基本单位，本模块将通过代码实现对进程全生命周期的控制。学习者将从零开始认识进程，管理进程状态，从而掌握进程系统调用以及对进程生命周期的管理。此外，进阶实验引入了 Linux 特有的克隆系统调用，指导学习者通过操纵 PID 命名空间来构建轻量级的容器隔离环境。模块还包含算法导向的任务，要求利用递归逻辑在内核中构建二叉进程树。

### 实验五：进程间通信与管道实验

本模块聚焦于操作系统进程间通信（IPC）的核心机制，以管道技术为切入点，系统展示了数据在独立进程空间之间高效流转与协同工作的关键逻辑。通过本模块的学习，学习者将深入理解内核如何通过缓冲区打破进程间的“信息孤岛”，掌握无名管道与有名管道在不同应用场景下的构建方法，并能熟练运用相关系统调用解决进程同步、标准 I/O 重定向及复杂双向通信等实际问题，从而在保证地址空间隔离与系统安全的前提下，构建起高效、协同的多进程软件架构。

### 实验六：多线程编程

为了解决多进程模型在通信效率与资源开销上的瓶颈，操作系统引入了轻量级执行单元——线程。实验首先通过对比测试，从实证角度验证了线程间共享地址空间而进程间内存隔离的本质区别。随后，课程深入探讨并发编程中的核心难题，即竞态条件与数据非一致性问题。学习者需通过编写高并发计数器程序复现原子性破坏的场景，并引入互斥锁机制来重建临界区的原子性。此外，本模块还涵盖了死锁成因分析与哲学家就餐问题，探讨资源有序分配与信号量限流等高级同步策略。

### 综合实验：内核实验复现

本模块聚焦于基于 Rust 语言的现代内核项目 NoAxiom 的工程复现与实践，通过对内核四层架构、硬件抽象层（HAL）解耦设计以及高性能异步任务调度范式的深度剖析，将抽象的操作系统理论转化为真实的工程实体。通过该模块的学习，学习者不仅能掌握复杂系统项目的环境配置、构建流程与 QEMU 模拟器调试等核心工程实践能力，更能深刻理解系统调用在多层架构间的流转逻辑，并能在亲手构建与调试的过程中，深入验证内存懒分配、写时复制、VFS 统一管理等核心机制，从而培养起应对真实高性能内核开发的问题定位思维与系统级架构的全局认知。

## 十、比赛收获

通过本次设计赛道的完整实践，团队成员不仅掌握了 Linux 系统编程的硬核技能，更重要的是建立起了“用户态验证原理，内核态观察实现”的系统观。在编写实验教程的过程中，我们对操作系统有了更深入的了解；而通过运行 NoAxiom-OS，我们直观地看到了这些原理在裸机上的具体形态。这种理论与实践相结合、自主实现与开源学习相结合的经历，极大地提升了我们在系统底层开发及工程构建方面的能力，也为后续的深入研究打下了坚实基础。
